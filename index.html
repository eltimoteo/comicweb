<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComicDB - VSCode Mode</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Fonts: Atkinson Hyperlegible Mono (User Request) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-editor: #1e1e1e;
            --bg-sidebar: #252526;
            --bg-activity: #333333;
            --border: #3e3e42;
            --accent: #007acc;
            --text-main: #d4d4d4;
            --keyword: #569cd6;      /* Blue */
            --string: #ce9178;       /* Orange/Brown */
            --function: #dcdcaa;     /* Yellow */
            --comment: #6a9955;      /* Green */
            --number: #b5cea8;       /* Light Green */
        }

        body {
            font-family: 'Atkinson Hyperlegible Mono', monospace;
            background-color: var(--bg-editor);
            color: var(--text-main);
        }

        /* Splash Screen Typing Cursor */
        .cursor::after {
            content: 'â–ˆ';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-editor); }
        ::-webkit-scrollbar-thumb { background: #424242; }
        ::-webkit-scrollbar-thumb:hover { background: #4f4f4f; }

        /* Utilities */
        .vscode-border { border: 1px solid var(--border); }
        .vscode-card { background-color: var(--bg-sidebar); }
        .vscode-input { 
            background-color: var(--activity); 
            border: 1px solid var(--border); 
            color: var(--text-main);
        }
        .vscode-input:focus { border-color: var(--accent); outline: none; }
    </style>
</head>

<body class="h-screen overflow-hidden flex flex-col">

    <!-- SPLASH SCREEN -->
    <div id="splash" class="fixed inset-0 z-50 bg-[#1e1e1e] flex items-center justify-center font-mono text-lg">
        <div class="w-full max-w-2xl p-10">
            <div id="terminal-text" class="text-green-500 mb-2"></div>
            <div class="text-gray-500 text-sm mt-4 hidden" id="splash-footer">Initializing environment... v1.42.0</div>
        </div>
    </div>

    <!-- VSCode Title Bar (Fake) -->
    <div class="h-8 bg-[#3c3c3c] flex items-center justify-between px-4 text-xs select-none">
        <div class="flex gap-4">
            <span class="font-bold">ComicDB.code-workspace</span>
            <span class="text-gray-400">File</span>
            <span class="text-gray-400">Edit</span>
            <span class="text-gray-400">Selection</span>
            <span class="text-gray-400">View</span>
        </div>
        
        <!-- Command Palette / Search (Centered) -->
        <div class="flex-1 max-w-xl mx-4 relative">
             <div class="bg-[#2d2d2d] rounded-md border border-[#4e4e4e] flex items-center px-2 py-0.5 w-full">
                <i class="fa-solid fa-search text-gray-400 text-xs mr-2"></i>
                <input type="text" id="searchInput" placeholder="Search files (Ctrl+P)"
                    class="bg-transparent border-none text-gray-300 text-xs w-full focus:outline-none placeholder-gray-500">
             </div>
        </div>

        <div class="flex gap-3 text-gray-400">
             <i class="fa-solid fa-window-minimize hover:text-white"></i>
             <i class="fa-regular fa-square hover:text-white"></i>
             <i class="fa-solid fa-xmark hover:text-white"></i>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Activity Bar (Left Sidebar) -->
        <div class="w-12 bg-[#333333] flex flex-col items-center py-4 gap-6 text-[#858585] text-xl border-r border-[#252526]">
            <i class="fa-solid fa-files text-white border-l-2 border-white pl-3 pr-4 py-1"></i> <!-- Explorer -->
            <i class="fa-solid fa-search hover:text-white transition cursor-pointer"></i>
            <i class="fa-solid fa-code-branch hover:text-white transition cursor-pointer"></i>
            <i class="fa-solid fa-bug hover:text-white transition cursor-pointer"></i>
            <div class="flex-1"></div>
            <i class="fa-solid fa-gear hover:text-white transition cursor-pointer mb-2"></i>
        </div>

        <!-- Sidebar (File Explorer) -->
        <div class="w-64 bg-[#252526] flex flex-col text-sm border-r border-[#1e1e1e] hidden md:flex">
            <div class="px-4 py-2 uppercase text-xs font-bold text-gray-400 tracking-wider">Explorer</div>
            
            <!-- Open Editors -->
            <div class="px-4 py-1 flex items-center gap-1 bg-[#37373d] text-white">
                <i class="fa-solid fa-chevron-down text-[10px]"></i> 
                <span class="font-bold">OPEN COMICS</span>
            </div>
            
            <!-- Folder Structure (Tabs) -->
            <div class="mt-2 pl-2">
                <div onclick="loadSheet('marvel')" id="btn-marvel" class="cursor-pointer px-2 py-1 flex items-center gap-2 hover:bg-[#2a2d2e] text-[#d4d4d4]">
                    <i class="fa-brands fa-js text-[#f1e05a]"></i> <!-- JS Icon for marvel -->
                    <span>marvel_comics.js</span>
                    <span id="badge-marvel" class="ml-auto text-[10px] bg-[#007acc] text-white px-1.5 rounded-full hidden">A</span>
                </div>
                <div onclick="loadSheet('dc')" id="btn-dc" class="cursor-pointer px-2 py-1 flex items-center gap-2 hover:bg-[#2a2d2e] text-[#d4d4d4]">
                    <i class="fa-brands fa-js text-[#f1e05a]"></i>
                    <span>dc_universe.js</span>
                </div>
                <div onclick="loadSheet('others')" id="btn-others" class="cursor-pointer px-2 py-1 flex items-center gap-2 hover:bg-[#2a2d2e] text-[#d4d4d4]">
                    <i class="fa-solid fa-file-code text-blue-400"></i>
                    <span>indie_reads.json</span>
                </div>
            </div>

            <div class="mt-6 px-4 py-2 uppercase text-xs font-bold text-gray-400 tracking-wider">Properties</div>
             <!-- Filters in Sidebar -->
             <div class="px-4 py-2 gap-3 flex flex-col">
                 <select id="readFilter" class="bg-[#3c3c3c] text-gray-300 text-xs p-1 border border-[#3e3e42] outline-none">
                     <option value="all">filter: all</option>
                     <option value="read">filter: read</option>
                     <option value="unread">filter: unread</option>
                 </select>
                 
                 <select id="sortSelect" class="bg-[#3c3c3c] text-gray-300 text-xs p-1 border border-[#3e3e42] outline-none">
                     <option value="title">sort: title.asc</option>
                     <option value="year">sort: year.desc</option>
                     <option value="rating">sort: rating.desc</option>
                 </select>
                 
                 <button id="orderBtn" class="text-left text-xs text-[#569cd6] hover:underline">
                     <i class="fa-solid fa-arrow-down-a-z"></i> toggle: direction
                 </button>
             </div>
        </div>

        <!-- Editor Area (Grid) -->
        <div class="flex-1 flex flex-col bg-[#1e1e1e] overflow-hidden">
            <!-- Tabs Header -->
            <div class="h-9 bg-[#2d2d2d] flex items-center overflow-x-auto text-sm border-b border-black">
                <div id="tab-label" class="bg-[#1e1e1e] text-[#d4d4d4] px-4 h-full flex items-center border-t-2 border-[#007acc] gap-2 pr-8 relative">
                    <i class="fa-brands fa-js text-yellow-500"></i>
                    <span>main.js</span>
                    <i class="fa-solid fa-xmark text-gray-500 hover:text-white absolute right-2 text-xs"></i>
                </div>
                <!-- Fake inactive tab -->
                <div class="bg-[#2d2d2d] text-gray-500 px-4 h-full flex items-center gap-2 border-r border-[#252526]">
                    <i class="fa-solid fa-file-lines"></i>
                    <span>README.md</span>
                </div>
            </div>

            <!-- Breadcrumbs -->
            <div class="h-6 flex items-center px-4 text-xs text-gray-500 gap-1 bg-[#1e1e1e]">
                <span>src</span> <i class="fa-solid fa-chevron-right text-[10px]"></i>
                <span>components</span> <i class="fa-solid fa-chevron-right text-[10px]"></i>
                <span id="crumb-active" class="text-white">marvel_comics.js</span>
                <span id="statsBar" class="ml-auto text-xs text-gray-500">Loading...</span>
            </div>

            <!-- Grid Content -->
            <div class="flex-1 overflow-y-auto p-4 md:p-6" id="scroll-container">
                <div id="loading" class="hidden text-center py-10">
                    <div class="text-[#569cd6]">Loading modules...</div>
                </div>

                <div id="comicGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
                    <!-- Cards -->
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="h-6 bg-[#007acc] flex items-center justify-between px-3 text-[11px] text-white">
        <div class="flex gap-4">
            <span><i class="fa-solid fa-code-branch text-[10px]"></i> main*</span>
            <span><i class="fa-regular fa-circle-xmark"></i> 0</span>
            <span><i class="fa-solid fa-triangle-exclamation"></i> 0</span>
        </div>
        <div class="flex gap-4">
            <span>Ln 12, Col 42</span>
            <span>UTF-8</span>
            <span>JavaScript</span>
            <span><i class="fa-regular fa-bell"></i></span>
        </div>
    </div>

    <script>
        // --- DATA CONFIG ---
        const sheetConfig = {
            marvel: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTFTPLKwr0aJgqiW3fPIbp5SvHLSDu6mPGnILzw9uMBKWfw7VdNykUY4NLiGNcb4dU3VI7XLkO8iSqX/pub?gid=61223904&single=true&output=csv",
            dc: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTFTPLKwr0aJgqiW3fPIbp5SvHLSDu6mPGnILzw9uMBKWfw7VdNykUY4NLiGNcb4dU3VI7XLkO8iSqX/pub?gid=0&single=true&output=csv",
            others: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTFTPLKwr0aJgqiW3fPIbp5SvHLSDu6mPGnILzw9uMBKWfw7VdNykUY4NLiGNcb4dU3VI7XLkO8iSqX/pub?gid=1684289763&single=true&output=csv"
        };

        let currentData = [];
        let currentTab = 'marvel';
        let isDescending = false;

        // --- SPLASH SCREEN LOGIC ---
        async function runSplash() {
            const terminal = document.getElementById('terminal-text');
            const footer = document.getElementById('splash-footer');
            const commands = [
                "> npm install comic-db",
                "[SUCCESS] Installed 142 packages in 0.4s",
                "> npm run dev",
                "> Server ready at localhost:3000..."
            ];

            for (const cmd of commands) {
                const p = document.createElement('div');
                p.className = cmd.startsWith(">") ? "text-white" : "text-gray-400 pl-4";
                terminal.appendChild(p);
                
                // Typing effect for commands
                if (cmd.startsWith(">")) {
                    p.innerHTML = "> <span class='cursor'></span>";
                    const text = cmd.substring(2);
                    for (let i = 0; i < text.length; i++) {
                        p.querySelector('span').textContent = text.substring(0, i + 1); // Remove cursor for now or keep it?
                        p.innerHTML = `> ${text.substring(0, i+1)}<span class='cursor'></span>`;
                        await new Promise(r => setTimeout(r, 30));
                    }
                    p.querySelector('.cursor').remove();
                } else {
                    p.innerText = cmd;
                    await new Promise(r => setTimeout(r, 200));
                }
                await new Promise(r => setTimeout(r, 300));
            }
            
            footer.classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                document.getElementById('splash').style.transition = 'opacity 0.5s';
                setTimeout(() => document.getElementById('splash').remove(), 500);
            }, 800);
        }

        document.addEventListener('DOMContentLoaded', () => {
            runSplash();
            loadSheet('marvel');

            // Listeners
            document.getElementById('searchInput').addEventListener('input', renderComics);
            document.getElementById('readFilter').addEventListener('change', renderComics);
            document.getElementById('sortSelect').addEventListener('change', renderComics);
            document.getElementById('orderBtn').addEventListener('click', () => {
                isDescending = !isDescending;
                renderComics();
            });
        });

        function loadSheet(key) {
            currentTab = key;
            const grid = document.getElementById('comicGrid');

            // Update Active State in Sidebar
            document.querySelectorAll('[id^="btn-"]').forEach(el => {
                el.classList.remove('bg-[#37373d]', 'text-white');
                el.classList.add('text-[#d4d4d4]');
            });
            const activeBtn = document.getElementById(`btn-${key}`);
            activeBtn.classList.add('bg-[#37373d]', 'text-white');
            activeBtn.classList.remove('text-[#d4d4d4]');
            
            // Update Breadcrumb & Tab
            const labels = { marvel: 'marvel_comics.js', dc: 'dc_universe.js', others: 'indie_reads.json' };
            document.getElementById('crumb-active').innerText = labels[key];
            document.getElementById('tab-label').querySelector('span').innerText = labels[key];

            grid.innerHTML = '';
            document.getElementById('loading').classList.remove('hidden');

            Papa.parse(sheetConfig[key], {
                download: true,
                header: true,
                complete: function (results) {
                    currentData = results.data;
                    document.getElementById('loading').classList.add('hidden');
                    renderComics();
                }
            });
        }

        function renderComics() {
            const grid = document.getElementById('comicGrid');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filter = document.getElementById('readFilter').value;
            const sortMode = document.getElementById('sortSelect').value;

            grid.innerHTML = '';

            const filtered = currentData.filter(row => {
                if (!row.TITLE) return false;
                const textMatch = (row.TITLE+row.WRITER+row.CHARACTER).toLowerCase().includes(search);
                const isRead = (row.READ || '').toUpperCase() === 'TRUE';
                if (filter === 'read' && !isRead) return false;
                if (filter === 'unread' && isRead) return false;
                return textMatch;
            });

            // Sort logic (same as before)
            filtered.sort((a, b) => {
                let res = 0;
                if (sortMode === 'title') res = (a.TITLE || '').localeCompare(b.TITLE || '');
                else if (sortMode === 'year') {
                    const getYear = s => (s || '').match(/\d{4}/) ? parseInt((s || '').match(/\d{4}/)[0]) : 0;
                    res = getYear(a.PUBLISH) - getYear(b.PUBLISH);
                }
                else if (sortMode === 'rating') res = (parseFloat(a.RATING) || -1) - (parseFloat(b.RATING) || -1);
                
                return isDescending ? -res : res;
            });

            document.getElementById('statsBar').innerText = `Objects: ${filtered.length}`;

            filtered.forEach(comic => {
                const isRead = (comic.READ || '').toUpperCase() === 'TRUE';
                
                // Code Block Card Style
                const div = document.createElement('div');
                div.className = "bg-[#252526] p-0 border-l-[3px] border-[#007acc] hover:border-white transition group relative overflow-hidden";
                if(currentTab === 'marvel') div.style.borderColor = "#c586c0"; // Purple for JS keywords
                if(currentTab === 'dc') div.style.borderColor = "#4fc1ff"; // Blue

                div.innerHTML = `
                    <!-- Image as tooltip/preview or small side thumbnail? Let's use standard image but dimmed -->
                    ${comic.IMAGE ? 
                        `<div class="h-32 overflow-hidden border-b border-[#3e3e42]">
                            <img src="${comic.IMAGE}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition">
                        </div>` : ''
                    }
                    
                    <div class="p-3 font-mono text-xs">
                        <div class="text-[#569cd6] mb-1">class <span class="text-[#4ec9b0]">${(comic.TITLE || '').replace(/\s+/g, '')}</span> {</div>
                        
                        <div class="pl-4 border-l border-[#3e3e42] ml-1">
                            <div><span class="text-[#9cdcfe]">author</span>: <span class="text-[#ce9178]">"${comic.WRITER}"</span>;</div>
                            <div><span class="text-[#9cdcfe]">year</span>: <span class="text-[#b5cea8]">${(comic.PUBLISH || '').match(/\d{4}/)?.[0] || 'null'}</span>;</div>
                            <div><span class="text-[#9cdcfe]">read</span>: <span class="text-[#569cd6]">${isRead}</span>;</div>
                            ${comic.RATING ? `<div><span class="text-[#9cdcfe]">rating</span>: <span class="text-[#b5cea8]">${comic.RATING}</span>;</div>` : ''}
                        </div>
                        
                        <div class="text-[#569cd6] mt-1">}</div>
                    </div>
                    
                    <!-- Hover Action -->
                    ${comic.LINK ? 
                    `<a href="${comic.LINK}" target="_blank" class="absolute top-2 right-2 px-2 py-1 bg-[#007acc] text-white text-xs opacity-0 group-hover:opacity-100 transition">
                        <i class="fa-solid fa-external-link-alt"></i> Open
                    </a>` : ''}
                `;
                grid.appendChild(div);
            });
        }
    </script>
</body>
</html>